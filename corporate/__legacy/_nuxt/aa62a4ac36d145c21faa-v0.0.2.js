(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{870:function(e,t,r){"use strict";r.r(t);r(70),r(72),r(59),r(9),r(112);var n,o=r(1),l=(r(12),r(432),r(51),r(71),r(93),r(166),r(42),r(22),r(429)),d=r(0),c=r.n(d),_={components:(n={ActiveButton:function(){return r.e(0).then(r.bind(null,822))},TextInput:function(){return r.e(10).then(r.bind(null,844))},CheckboxInput:function(){return Promise.all([r.e(1),r.e(2),r.e(20),r.e(27)]).then(r.bind(null,845))},OverviewLabel:function(){return r.e(111).then(r.bind(null,846))},ContentTableView:function(){return r.e(12).then(r.bind(null,833))},PriceLabel:function(){return r.e(17).then(r.bind(null,834))},ModalConfirmation:function(){return r.e(19).then(r.bind(null,831))},LabelStatusGroup:function(){return r.e(14).then(r.bind(null,835))}},n.ActiveButton=function(){return r.e(0).then(r.bind(null,822))},n),props:{month:{required:!0},is_paying:{default:!1}},data:function(){return{id:"table-review-membership",corporate:{},data:[],previous_data:[],wasExtended:[],selected_data:[],pagination:{per_page:10,current_page:1,total_data:0},modal:{warning:!1,confirmation:!1},helper:{is_loading:!1,is_error:!1,is_filling:!1},filter:{key:"",data:[]}}},watch:{selected_data:function(){this.processCountSelected()},month:function(){this.previous_data=[],this.wasExtended=[],this.selected_data=[],this.selected_data=[],this.processGetData()},is_paying:function(e){e&&this.processValidateInvoice()}},mounted:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.corporate=JSON.parse(e.$utility.getCookie("corporate")),e.processGetData();case 1:case"end":return t.stop()}},t)}))()},methods:{getCorporateEmployee:l.corporateMembershipMethods.getCorporateEmployee,getCorporateMembership:l.corporateMembershipMethods.getCorporateMembership,createMembershipInvoice:l.paymentMembershipMethods.createMembershipInvoice,setPayloadGetEmployee:function(){return{corporate_id:this.corporate.id,filter:[],pagination:{current_page:1,per_page:1e3}}},setPayloadGetMembership:function(e){void 0===e&&(e=!1);var t={corporate_id:this.corporate.id,filter:[],pagination:{current_page:1,per_page:1e3}};if(e)t.filter.push({key:"month",value:this.month});else{var r=c()(this.month).subtract(1,"month").format("YYYY-MM");t.filter.push({key:"month",value:r})}return t},setPayloadInvoice:function(){return{corporate_id:this.corporate.id,spot_id:this.corporate.spot_id,start_month:this.month,employee_ids:this.selected_data}},toggleFormatMembership:function(data){var e,t={product_name:"",product_price:"",membership_rf_id:"",membership_card_id:"",product_vehicle:"",membership_status:"",license_plate_1:"",license_plate_2:"",license_plate_3:""},r="",n=!1;"CARD"===this.corporate.membership_type?(r="card",n=!data.card.license_plate):(r="motorcycle",n=!(null!=(e=data.motorcycle[0])&&e.license_plate));var source=n?data.expired["expired_"+r]:data[r];return Array.isArray(source)?(t.license_plate_1=source[0]&&source[0].license_plate?source[0].license_plate:"",t.license_plate_2=source[1]&&source[1].license_plate?source[1].license_plate:"",t.license_plate_3=source[2]&&source[2].license_plate?source[2].license_plate:"",t.product_name=source[0].product_detail.name,t.product_vehicle=source[0].product_detail.vehicle_code,t.product_price=this.$utility.convertToRupiah(source[0].product_detail.price),t.membership_status=!n):(t.membership_rf_id=source.rf_id,t.membership_card_id=source.card_id,t.product_name=source.product_detail.name,t.product_vehicle=source.product_detail.vehicle_code,t.product_price=this.$utility.convertToRupiah(source.product_detail.price),t.license_plate_1=source.license_plate,source.second_license_plate&&(t.license_plate_2=source.second_license_plate),t.membership_status=!n),t},processCountSelected:function(){var e=this,t={motorcycle_bill:0,motorcycle_sum:0,car_bill:0,car_sum:0,new_card_sum:0};this.selected_data.map(function(r){var n=e.data.find(function(e){return e.id===r});if(n){if(n.product_vehicle.toLowerCase().includes("mt")){var o=e.processCountMemberMotorycyle(t,n.product_price),l=o.motorcycleBills,d=o.motorcycleSum;t.motorcycle_bill=l,t.motorcycle_sum=d}else{var c=e.processCountMemberCar(t,n.product_price),_=c.carBills,m=c.carSum;t.car_bill=_,t.car_sum=m}var h=e.processCountNewCard(t,n.expired).newCardSum;t.new_card_sum=h}}),this.$emit("counted",t)},processCountNewCard:function(e,t){var r,n=e.new_card_sum;"CARD"===this.corporate.membership_type?9466596e5===(null==(r=t.expired_card)?void 0:r.end)&&(n=e.new_card_sum+1):9466596e5===t.expired_motorcycle[0].end&&(n=e.new_card_sum+1);return{newCardSum:n}},processCountMemberMotorycyle:function(e,t){return{motorcycleBills:parseInt(e.motorcycle_bill+=this.$utility.convertToNumber(t)),motorcycleSum:parseInt(e.motorcycle_sum+=1)}},processCountMemberCar:function(e,t){return{carBills:parseInt(e.car_bill+=this.$utility.convertToNumber(t)),carSum:parseInt(e.car_sum+=1)}},processFormatData:function(data){var e=this;this.data=data.map(function(t){var r,n,o,l;return t=Object.assign({},t,e.toggleFormatMembership(t),{phone_number:null!=(r=null==(n=t.additional_data)?void 0:n.phone_number)?r:"-",dob:null!=(o=null==(l=t.additional_data)?void 0:l.dob)?o:"-"})})},processSearchData:function(){var e=this;""===this.filter.key?this.filter.data=this.data:this.filter.data=this.data.filter(function(t){return t.name.toLowerCase().includes(e.filter.key.toLowerCase())||t.email.toLowerCase().includes(e.filter.key.toLowerCase())||t.license_plate_1.toLowerCase().includes(e.filter.key.toLowerCase())||t.license_plate_2.toLowerCase().includes(e.filter.key.toLowerCase())||t.license_plate_3.toLowerCase().includes(e.filter.key.toLowerCase())||t.rf_id.toLowerCase().includes(e.filter.key.toLowerCase())||t.phone_number.toLowerCase().includes(e.filter.key.toLowerCase())})},processFillPreviousMember:function(data){this.selected_data=data.map(function(e){return e.employee_id}),this.helper.is_filling=!1},processFillExtendedMember:function(data){this.wasExtended=data.map(function(e){return e.employee_id}),this.helper.is_filling=!1},processGetData:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark(function t(){var r,n,o,l,d;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.helper.is_error=!1,e.helper.is_loading=!0,t.prev=1,r=e.setPayloadGetEmployee(),t.next=2,e.getCorporateEmployee(r);case 2:n=t.sent,o=n.values,l=n.total_values,e.processFormatData(o),e.filter.data=e.data,e.pagination.total_data=l,e.processGetPreviousMember(),t.next=4;break;case 3:t.prev=3,d=t.catch(1),e.data=[],e.pagination.total_data=0,e.$utility.setErrorContextSentry(d),e.$sentry.captureException(d.message+" in TablePaymentReview at processGetData");case 4:e.$emit("ready"),e.helper.is_loading=!1;case 5:case"end":return t.stop()}},t,null,[[1,3]])}))()},processGetPreviousMember:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark(function r(){var n,o,l,d;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return void 0===e&&(e=!0),t.helper.is_filling=!0,r.prev=1,n=t.setPayloadGetMembership(e),r.next=2,t.getCorporateMembership(n);case 2:o=r.sent,(l=o.values).length>0&&e?t.processFillExtendedMember(l):e?t.processGetPreviousMember(!1):t.processFillPreviousMember(l),r.next=4;break;case 3:r.prev=3,d=r.catch(1),t.data=[],t.pagination.total_data=0,t.$utility.setErrorContextSentry(d),t.$sentry.captureException(d.message+" in TablePaymentReview at processGetData");case 4:case"end":return r.stop()}},r,null,[[1,3]])}))()},processValidateInvoice:function(){0===this.selected_data.length?(this.modal.warning=!0,this.$emit("resetCharge",!0)):(this.$emit("resetCharge",!0),this.modal.confirmation=!0)},processCreateInvoice:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark(function t(){var r,n,o,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.helper.is_error=!1,e.helper.is_loading=!0,t.prev=1,r=e.setPayloadInvoice(),t.next=2,e.createMembershipInvoice(r);case 2:n=t.sent,o=n.values,e.modal.confirmation=!1,e.$emit("successCharge",o),t.next=4;break;case 3:t.prev=3,l=t.catch(1),e.$utility.setErrorContextSentry(l),e.$sentry.captureException(l.message+" in TablePaymentReview at processCreateInvoice"),e.$emit("resetCharge",!0);case 4:e.helper.is_loading=!1;case 5:case"end":return t.stop()}},t,null,[[1,3]])}))()}}},m=r(38),component=Object(m.a)(_,function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"bg-white rounded pt-3"},[t("div",{staticClass:"d-flex justify-content-between px-4"},[t("div",[t("p",{staticClass:"m-0 p-0 font-weight-bold font-size-18"},[e._v("\n          Daftar Pengguna\n          "+e._s(e.$utility.formatDateMoment(String(e.month)+"-01","MMMM  YYYY"))+"\n        ")])]),e._v(" "),t("div",{},[t("div",{staticClass:"d-flex"},[t("div",[t("text-input",{attrs:{placeholder:"Cari Data",id:"input-filter__"+e.id,test_id:"input-filter__"+e.id},on:{submit:e.processSearchData},model:{value:e.filter.key,callback:function(t){e.$set(e.filter,"key",t)},expression:"filter.key"}})],1),e._v(" "),t("div",[t("active-button",{attrs:{id:"btn-close_update_modal_version",additional_class:"ml-1",text:"Cari",align:"rtl",icon:"ic-search-md",test_id:"btn-close_update_modal_version"},on:{click:e.processSearchData}})],1)])])]),e._v(" "),t("content-table-view",{attrs:{length:e.filter.data.length,is_loading:e.helper.is_loading,is_error:e.helper.is_error,id:"wrapper__"+e.id,test_id:"wrapper__"+e.id}},[t("div",{staticClass:"table-responsive rounded-top table-freeze mb-0"},[t("table",{staticClass:"table-striped table-borderless mb-0 table-spn w-100",attrs:{"data-testid":e.id}},[t("thead",{staticClass:"thead-freeze bg-gray-70"},[t("tr",{staticClass:"border-bottom-table"},[t("th",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__th-no"}},[e._v("No")]),e._v(" "),t("th",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__th-name"}},[e._v("Nama")]),e._v(" "),t("th",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__th-phone_number"}},[e._v("\n                No Telepon\n              ")]),e._v(" "),t("th",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__th-dob"}},[e._v("\n                Tanggal Lahir\n              ")]),e._v(" "),t("th",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__th-email"}},[e._v("\n                Email\n              ")]),e._v(" "),t("th",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__th-license_plate_1"}},[e._v("\n                Plat No 1\n              ")]),e._v(" "),t("th",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__th-license_plate_2"}},[e._v("\n                Plat No 2\n              ")]),e._v(" "),"LICENSE_PLATE"===e.corporate.membership_type?t("th",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__th-license_plate_3"}},[e._v("\n                Plat No 3\n              ")]):e._e(),e._v(" "),"CARD"===e.corporate.membership_type?t("th",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__th-rfid"}},[e._v("\n                RF ID\n              ")]):e._e(),e._v(" "),t("th",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__th-product"}},[e._v("\n                Produk\n              ")]),e._v(" "),t("th",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__th-options"}})])]),e._v(" "),t("tbody",e._l(e.filter.data,function(r,n){return t("tr",{key:"member-"+n},[t("td",{attrs:{"data-testid":e.id+"__tr-"+n+"__td-no"}},[e._v("\n                "+e._s(n+10*(e.pagination.current_page-1)+1)+"\n              ")]),e._v(" "),t("td",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__tr-"+n+"__td-name"}},[t("overview-label",{ref:"overview-name-"+n,refInFor:!0,attrs:{additional_class:"my-0",has_space:!1,value:r.name,limit_text:"10",is_italic:!1}})],1),e._v(" "),t("td",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__tr-"+n+"__td-phone_number"}},[t("overview-label",{ref:"overview-phone_number-"+n,refInFor:!0,attrs:{additional_class:"my-0",has_space:!1,value:r.phone_number,limit_text:"8",is_italic:!1}})],1),e._v(" "),t("td",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__tr-"+n+"__td-dob"}},[e._v("\n                "+e._s(r.additional_data&&r.additional_data.dob?e.$utility.formatDateMoment(r.additional_data.dob,"DD-MM-YYYY"):"-")+"\n              ")]),e._v(" "),t("td",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__tr-"+n+"__td-email"}},[t("overview-label",{ref:"overview-email-"+n,refInFor:!0,attrs:{additional_class:"my-0",has_space:!1,value:r.email,limit_text:"10",is_italic:!1}})],1),e._v(" "),t("td",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__tr-"+n+"__td-license_plate_1"}},[e._v("\n                "+e._s(r.license_plate_1)+"\n              ")]),e._v(" "),t("td",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__tr-"+n+"__td-license_plate_2"}},[e._v("\n                "+e._s(r.license_plate_2)+"\n              ")]),e._v(" "),"LICENSE_PLATE"===e.corporate.membership_type?t("td",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__tr-"+n+"__td-license_plate_3"}},[e._v("\n                "+e._s(r.license_plate_3)+"\n              ")]):e._e(),e._v(" "),"CARD"===e.corporate.membership_type?t("td",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__tr-"+n+"__td-rf_id"}},[e._v("\n                "+e._s(r.membership_rf_id)+"\n              ")]):e._e(),e._v(" "),t("td",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__tr-"+n+"__td-product"}},[t("overview-label",{ref:"overview-product_name-"+n,refInFor:!0,attrs:{additional_class:"my-0",has_space:!1,value:r.product_name,limit_text:"15",is_italic:!1}})],1),e._v(" "),t("td",{staticClass:"text-dark",attrs:{"data-testid":e.id+"__tr-"+n+"__td-options"}},[e.wasExtended.includes(r.id)?e._e():t("checkbox-input",{ref:"add-"+e.id+"__"+n,refInFor:!0,attrs:{id:"add-"+e.id+"__"+n,test_id:"add-"+e.id+"__"+n,options:[{text:"",value:r.id}]},model:{value:e.selected_data,callback:function(t){e.selected_data=t},expression:"selected_data"}})],1)])}),0)])])]),e._v(" "),t("b-toast",{attrs:{"no-auto-hide":"",visible:e.helper.is_filling,id:"toast_last_sync",toaster:"b-toaster-bottom-right","header-class":"d-none",variant:"dark"}},[t("template",{slot:"default"},[t("div",{staticClass:"d-flex flex-row"},[t("div",{staticClass:"text-dark"},[t("b-spinner",{staticClass:"text-white",attrs:{small:""}})],1),e._v(" "),t("div",{staticClass:"align-self-lg-center align-middle text-white flex-grow-1 ml-2 font-size-12"},[e._v("\n            Kami sedang menyiapkan auto check untuk data membership anda\n          ")])])])],2)],1),e._v(" "),t("modal-confirmation",{attrs:{text:"Anda belum memilih data pegawai anda yang ingin di perpanjang",title:"Pegawai belum di pilih",cancel_button_text:"Mengerti",submit_button_class:"d-none"},on:{cancel:function(t){e.modal.warning=!1}},model:{value:e.modal.warning,callback:function(t){e.$set(e.modal,"warning",t)},expression:"modal.warning"}}),e._v(" "),t("modal-confirmation",{attrs:{title:"Konfirmasi",text:"Apakah anda yakin seluruh data karyawan pegawai yang anda pilih sudah sesuai?",submit_button_text:"Submit",is_loading:e.helper.is_loading},on:{cancel:function(t){e.modal.confirmation=!1},submit:function(t){return e.processCreateInvoice()}},model:{value:e.modal.confirmation,callback:function(t){e.$set(e.modal,"confirmation",t)},expression:"modal.confirmation"}})],1)},[],!1,null,null,null);t.default=component.exports}}]);