(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{869:function(t,e,r){"use strict";r.r(e);r(36),r(44),r(76),r(62),r(9),r(113);var n=r(1),o=r(37),c=(r(12),r(54),r(435),r(75),r(96),r(97),r(53),r(48),r(64),r(22),r(432)),l=r(0),d=r.n(l);function _(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function m(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_(Object(r),!0).forEach(function(e){Object(o.a)(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var h={components:Object(o.a)({ActiveButton:function(){return r.e(0).then(r.bind(null,821))},TextInput:function(){return r.e(10).then(r.bind(null,843))},CheckboxInput:function(){return Promise.all([r.e(1),r.e(2),r.e(20),r.e(27)]).then(r.bind(null,844))},OverviewLabel:function(){return r.e(112).then(r.bind(null,845))},ContentTableView:function(){return r.e(12).then(r.bind(null,832))},PriceLabel:function(){return r.e(17).then(r.bind(null,833))},ModalConfirmation:function(){return r.e(19).then(r.bind(null,830))},LabelStatusGroup:function(){return r.e(14).then(r.bind(null,834))}},"ActiveButton",function(){return r.e(0).then(r.bind(null,821))}),props:{month:{required:!0},is_paying:{default:!1}},data:function(){return{id:"table-review-membership",corporate:{},data:[],previous_data:[],wasExtended:[],selected_data:[],pagination:{per_page:10,current_page:1,total_data:0},modal:{warning:!1,confirmation:!1},helper:{is_loading:!1,is_error:!1,is_filling:!1},filter:{key:"",data:[]}}},watch:{selected_data:function(){this.processCountSelected()},month:function(){this.previous_data=[],this.wasExtended=[],this.selected_data=[],this.selected_data=[],this.processGetData()},is_paying:function(t){t&&this.processValidateInvoice()}},mounted:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.corporate=JSON.parse(t.$utility.getCookie("corporate")),t.processGetData();case 1:case"end":return e.stop()}},e)}))()},methods:{getCorporateEmployee:c.corporateMembershipMethods.getCorporateEmployee,getCorporateMembership:c.corporateMembershipMethods.getCorporateMembership,createMembershipInvoice:c.paymentMembershipMethods.createMembershipInvoice,setPayloadGetEmployee:function(){return{corporate_id:this.corporate.id,filter:[],pagination:{current_page:1,per_page:1e3}}},setPayloadGetMembership:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={corporate_id:this.corporate.id,filter:[],pagination:{current_page:1,per_page:1e3}};if(t)e.filter.push({key:"month",value:this.month});else{var r=d()(this.month).subtract(1,"month").format("YYYY-MM");e.filter.push({key:"month",value:r})}return e},setPayloadInvoice:function(){return{corporate_id:this.corporate.id,spot_id:this.corporate.spot_id,start_month:this.month,employee_ids:this.selected_data}},toggleFormatMembership:function(data){var t,e={product_name:"",product_price:"",membership_rf_id:"",membership_card_id:"",product_vehicle:"",membership_status:"",license_plate_1:"",license_plate_2:"",license_plate_3:""},r="",n=!1;"CARD"===this.corporate.membership_type?(r="card",n=!data.card.license_plate):(r="motorcycle",n=!(null!==(t=data.motorcycle[0])&&void 0!==t&&t.license_plate));var source=n?data.expired["expired_".concat(r)]:data[r];return Array.isArray(source)?(e.license_plate_1=source[0]&&source[0].license_plate?source[0].license_plate:"",e.license_plate_2=source[1]&&source[1].license_plate?source[1].license_plate:"",e.license_plate_3=source[2]&&source[2].license_plate?source[2].license_plate:"",e.product_name=source[0].product_detail.name,e.product_vehicle=source[0].product_detail.vehicle_code,e.product_price=this.$utility.convertToRupiah(source[0].product_detail.price),e.membership_status=!n):(e.membership_rf_id=source.rf_id,e.membership_card_id=source.card_id,e.product_name=source.product_detail.name,e.product_vehicle=source.product_detail.vehicle_code,e.product_price=this.$utility.convertToRupiah(source.product_detail.price),e.license_plate_1=source.license_plate,source.second_license_plate&&(e.license_plate_2=source.second_license_plate),e.membership_status=!n),e},processCountSelected:function(){var t=this,e={motorcycle_bill:0,motorcycle_sum:0,car_bill:0,car_sum:0,new_card_sum:0};this.selected_data.map(function(r){var n=t.data.find(function(t){return t.id===r});if(n){if(n.product_vehicle.toLowerCase().includes("mt")){var o=t.processCountMemberMotorycyle(e,n.product_price),c=o.motorcycleBills,l=o.motorcycleSum;e.motorcycle_bill=c,e.motorcycle_sum=l}else{var d=t.processCountMemberCar(e,n.product_price),_=d.carBills,m=d.carSum;e.car_bill=_,e.car_sum=m}var h=t.processCountNewCard(e,n.expired).newCardSum;e.new_card_sum=h}}),this.$emit("counted",e)},processCountNewCard:function(t,e){var r,n=t.new_card_sum;"CARD"===this.corporate.membership_type?9466596e5===(null===(r=e.expired_card)||void 0===r?void 0:r.end)&&(n=t.new_card_sum+1):9466596e5===e.expired_motorcycle[0].end&&(n=t.new_card_sum+1);return{newCardSum:n}},processCountMemberMotorycyle:function(t,e){return{motorcycleBills:parseInt(t.motorcycle_bill+=this.$utility.convertToNumber(e)),motorcycleSum:parseInt(t.motorcycle_sum+=1)}},processCountMemberCar:function(t,e){return{carBills:parseInt(t.car_bill+=this.$utility.convertToNumber(e)),carSum:parseInt(t.car_sum+=1)}},processFormatData:function(data){var t=this;this.data=data.map(function(e){var r,n,o,c;return e=m(m(m({},e),t.toggleFormatMembership(e)),{},{phone_number:null!==(r=null===(n=e.additional_data)||void 0===n?void 0:n.phone_number)&&void 0!==r?r:"-",dob:null!==(o=null===(c=e.additional_data)||void 0===c?void 0:c.dob)&&void 0!==o?o:"-"})})},processSearchData:function(){var t=this;""===this.filter.key?this.filter.data=this.data:this.filter.data=this.data.filter(function(e){return e.name.toLowerCase().includes(t.filter.key.toLowerCase())||e.email.toLowerCase().includes(t.filter.key.toLowerCase())||e.license_plate_1.toLowerCase().includes(t.filter.key.toLowerCase())||e.license_plate_2.toLowerCase().includes(t.filter.key.toLowerCase())||e.license_plate_3.toLowerCase().includes(t.filter.key.toLowerCase())||e.rf_id.toLowerCase().includes(t.filter.key.toLowerCase())||e.phone_number.toLowerCase().includes(t.filter.key.toLowerCase())})},processFillPreviousMember:function(data){this.selected_data=data.map(function(t){return t.employee_id}),this.helper.is_filling=!1},processFillExtendedMember:function(data){this.wasExtended=data.map(function(t){return t.employee_id}),this.helper.is_filling=!1},processGetData:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark(function e(){var r,n,o,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.helper.is_error=!1,t.helper.is_loading=!0,e.prev=1,r=t.setPayloadGetEmployee(),e.next=2,t.getCorporateEmployee(r);case 2:n=e.sent,o=n.values,c=n.total_values,t.processFormatData(o),t.filter.data=t.data,t.pagination.total_data=c,t.processGetPreviousMember(),e.next=4;break;case 3:e.prev=3,l=e.catch(1),t.data=[],t.pagination.total_data=0,t.$utility.setErrorContextSentry(l),t.$sentry.captureException("".concat(l.message," in TablePaymentReview at processGetData"));case 4:t.$emit("ready"),t.helper.is_loading=!1;case 5:case"end":return e.stop()}},e,null,[[1,3]])}))()},processGetPreviousMember:function(){var t=arguments,e=this;return Object(n.a)(regeneratorRuntime.mark(function r(){var n,o,c,l,d;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=!(t.length>0&&void 0!==t[0])||t[0],e.helper.is_filling=!0,r.prev=1,o=e.setPayloadGetMembership(n),r.next=2,e.getCorporateMembership(o);case 2:c=r.sent,(l=c.values).length>0&&n?e.processFillExtendedMember(l):n?e.processGetPreviousMember(!1):e.processFillPreviousMember(l),r.next=4;break;case 3:r.prev=3,d=r.catch(1),e.data=[],e.pagination.total_data=0,e.$utility.setErrorContextSentry(d),e.$sentry.captureException("".concat(d.message," in TablePaymentReview at processGetData"));case 4:case"end":return r.stop()}},r,null,[[1,3]])}))()},processValidateInvoice:function(){0===this.selected_data.length?(this.modal.warning=!0,this.$emit("resetCharge",!0)):(this.$emit("resetCharge",!0),this.modal.confirmation=!0)},processCreateInvoice:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark(function e(){var r,n,o,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.helper.is_error=!1,t.helper.is_loading=!0,e.prev=1,r=t.setPayloadInvoice(),e.next=2,t.createMembershipInvoice(r);case 2:n=e.sent,o=n.values,t.modal.confirmation=!1,t.$emit("successCharge",o),e.next=4;break;case 3:e.prev=3,c=e.catch(1),t.$utility.setErrorContextSentry(c),t.$sentry.captureException("".concat(c.message," in TablePaymentReview at processCreateInvoice")),t.$emit("resetCharge",!0);case 4:t.helper.is_loading=!1;case 5:case"end":return e.stop()}},e,null,[[1,3]])}))()}}},v=h,f=r(43),component=Object(f.a)(v,function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"bg-white rounded pt-3"},[e("div",{staticClass:"d-flex justify-content-between px-4"},[e("div",[e("p",{staticClass:"m-0 p-0 font-weight-bold font-size-18"},[t._v("\n          Daftar Pengguna\n          "+t._s(t.$utility.formatDateMoment("".concat(String(t.month),"-01"),"MMMM  YYYY"))+"\n        ")])]),t._v(" "),e("div",{},[e("div",{staticClass:"d-flex"},[e("div",[e("text-input",{attrs:{placeholder:"Cari Data",id:"input-filter__".concat(t.id),test_id:"input-filter__".concat(t.id)},on:{submit:t.processSearchData},model:{value:t.filter.key,callback:function(e){t.$set(t.filter,"key",e)},expression:"filter.key"}})],1),t._v(" "),e("div",[e("active-button",{attrs:{id:"btn-close_update_modal_version",additional_class:"ml-1",text:"Cari",align:"rtl",icon:"ic-search-md",test_id:"btn-close_update_modal_version"},on:{click:t.processSearchData}})],1)])])]),t._v(" "),e("content-table-view",{attrs:{length:t.filter.data.length,is_loading:t.helper.is_loading,is_error:t.helper.is_error,id:"wrapper__".concat(t.id),test_id:"wrapper__".concat(t.id)}},[e("div",{staticClass:"table-responsive rounded-top table-freeze mb-0"},[e("table",{staticClass:"table-striped table-borderless mb-0 table-spn w-100",attrs:{"data-testid":t.id}},[e("thead",{staticClass:"thead-freeze bg-gray-70"},[e("tr",{staticClass:"border-bottom-table"},[e("th",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__th-no")}},[t._v("No")]),t._v(" "),e("th",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__th-name")}},[t._v("Nama")]),t._v(" "),e("th",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__th-phone_number")}},[t._v("\n                No Telepon\n              ")]),t._v(" "),e("th",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__th-dob")}},[t._v("\n                Tanggal Lahir\n              ")]),t._v(" "),e("th",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__th-email")}},[t._v("\n                Email\n              ")]),t._v(" "),e("th",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__th-license_plate_1")}},[t._v("\n                Plat No 1\n              ")]),t._v(" "),e("th",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__th-license_plate_2")}},[t._v("\n                Plat No 2\n              ")]),t._v(" "),"LICENSE_PLATE"===t.corporate.membership_type?e("th",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__th-license_plate_3")}},[t._v("\n                Plat No 3\n              ")]):t._e(),t._v(" "),"CARD"===t.corporate.membership_type?e("th",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__th-rfid")}},[t._v("\n                RF ID\n              ")]):t._e(),t._v(" "),e("th",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__th-product")}},[t._v("\n                Produk\n              ")]),t._v(" "),e("th",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__th-options")}})])]),t._v(" "),e("tbody",t._l(t.filter.data,function(r,n){return e("tr",{key:"member-".concat(n)},[e("td",{attrs:{"data-testid":"".concat(t.id,"__tr-").concat(n,"__td-no")}},[t._v("\n                "+t._s(n+10*(t.pagination.current_page-1)+1)+"\n              ")]),t._v(" "),e("td",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__tr-").concat(n,"__td-name")}},[e("overview-label",{ref:"overview-name-".concat(n),refInFor:!0,attrs:{additional_class:"my-0",has_space:!1,value:r.name,limit_text:"10",is_italic:!1}})],1),t._v(" "),e("td",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__tr-").concat(n,"__td-phone_number")}},[e("overview-label",{ref:"overview-phone_number-".concat(n),refInFor:!0,attrs:{additional_class:"my-0",has_space:!1,value:r.phone_number,limit_text:"8",is_italic:!1}})],1),t._v(" "),e("td",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__tr-").concat(n,"__td-dob")}},[t._v("\n                "+t._s(r.additional_data&&r.additional_data.dob?t.$utility.formatDateMoment(r.additional_data.dob,"DD-MM-YYYY"):"-")+"\n              ")]),t._v(" "),e("td",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__tr-").concat(n,"__td-email")}},[e("overview-label",{ref:"overview-email-".concat(n),refInFor:!0,attrs:{additional_class:"my-0",has_space:!1,value:r.email,limit_text:"10",is_italic:!1}})],1),t._v(" "),e("td",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__tr-").concat(n,"__td-license_plate_1")}},[t._v("\n                "+t._s(r.license_plate_1)+"\n              ")]),t._v(" "),e("td",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__tr-").concat(n,"__td-license_plate_2")}},[t._v("\n                "+t._s(r.license_plate_2)+"\n              ")]),t._v(" "),"LICENSE_PLATE"===t.corporate.membership_type?e("td",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__tr-").concat(n,"__td-license_plate_3")}},[t._v("\n                "+t._s(r.license_plate_3)+"\n              ")]):t._e(),t._v(" "),"CARD"===t.corporate.membership_type?e("td",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__tr-").concat(n,"__td-rf_id")}},[t._v("\n                "+t._s(r.membership_rf_id)+"\n              ")]):t._e(),t._v(" "),e("td",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__tr-").concat(n,"__td-product")}},[e("overview-label",{ref:"overview-product_name-".concat(n),refInFor:!0,attrs:{additional_class:"my-0",has_space:!1,value:r.product_name,limit_text:"15",is_italic:!1}})],1),t._v(" "),e("td",{staticClass:"text-dark",attrs:{"data-testid":"".concat(t.id,"__tr-").concat(n,"__td-options")}},[t.wasExtended.includes(r.id)?t._e():e("checkbox-input",{ref:"add-".concat(t.id,"__").concat(n),refInFor:!0,attrs:{id:"add-".concat(t.id,"__").concat(n),test_id:"add-".concat(t.id,"__").concat(n),options:[{text:"",value:r.id}]},model:{value:t.selected_data,callback:function(e){t.selected_data=e},expression:"selected_data"}})],1)])}),0)])])]),t._v(" "),e("b-toast",{attrs:{"no-auto-hide":"",visible:t.helper.is_filling,id:"toast_last_sync",toaster:"b-toaster-bottom-right","header-class":"d-none",variant:"dark"}},[e("template",{slot:"default"},[e("div",{staticClass:"d-flex flex-row"},[e("div",{staticClass:"text-dark"},[e("b-spinner",{staticClass:"text-white",attrs:{small:""}})],1),t._v(" "),e("div",{staticClass:"align-self-lg-center align-middle text-white flex-grow-1 ml-2 font-size-12"},[t._v("\n            Kami sedang menyiapkan auto check untuk data membership anda\n          ")])])])],2)],1),t._v(" "),e("modal-confirmation",{attrs:{text:"Anda belum memilih data pegawai anda yang ingin di perpanjang",title:"Pegawai belum di pilih",cancel_button_text:"Mengerti",submit_button_class:"d-none"},on:{cancel:function(e){t.modal.warning=!1}},model:{value:t.modal.warning,callback:function(e){t.$set(t.modal,"warning",e)},expression:"modal.warning"}}),t._v(" "),e("modal-confirmation",{attrs:{title:"Konfirmasi",text:"Apakah anda yakin seluruh data karyawan pegawai yang anda pilih sudah sesuai?",submit_button_text:"Submit",is_loading:t.helper.is_loading},on:{cancel:function(e){t.modal.confirmation=!1},submit:function(e){return t.processCreateInvoice()}},model:{value:t.modal.confirmation,callback:function(e){t.$set(t.modal,"confirmation",e)},expression:"modal.confirmation"}})],1)},[],!1,null,null,null);e.default=component.exports}}]);