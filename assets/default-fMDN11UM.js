import{_ as E,x as L,p as b,z as A,B as T,c as k,o as w,w as v,q as S,b as B,h as M,d as H}from"./index-DDrS01Mm.js";import{L as N}from"./main-BWNwx6sK.js";import"./useUtility-BVF-gAVc.js";import"./useAcl-CciIFekO.js";const q={key:0,class:"legacy-loader"},f="legacy-harbor-root",m="/harbor/__legacy",c="legacy-harbor-asset",C={__name:"default",setup(I){const h=S(),l=L(!0);function x(e){return e.replace(/\?.*$/,"").replace(/#.*$/,"").replace(/^\/harbor/,"").replace(/\/$/,"")}function $(){const e=x(h.fullPath),o=`${window.location.origin}${m}${e||""}/index.html`,t=`${window.location.origin}${m}/index.html`;return{primary:o,fallback:t,rel:e}}function p(){document.querySelectorAll(`link[rel="stylesheet"][data-${c}]`).forEach(e=>e.remove()),document.querySelectorAll(`script[data-${c}]`).forEach(e=>e.remove())}function y(e){const o="/_nuxt/",t=e.indexOf(o);if(t===-1)return e;const n=e.slice(t+o.length);return`${window.location.origin}${m}/_nuxt/${n}`}async function _(){const{primary:e,fallback:o}=$();try{let t=await fetch(e,{credentials:"same-origin"}),n="";if(t.ok)n=await t.text();else{if(t=await fetch(o,{credentials:"same-origin"}),!t.ok)throw new Error(`Legacy HTML not found. Tried: ${e} & ${o}`);n=await t.text()}const s=document.getElementById(f);if(!s)throw new Error(`No container #${f}`);s.innerHTML="",p();const a=document.createElement("div");a.innerHTML=n;let g=a.querySelector("#__nuxt");if(!g)throw console.error("Injected HTML DOES NOT contain #__nuxt. URL used:",t.url),new Error("No __nuxt root found in legacy HTML");s.appendChild(g),a.querySelectorAll('link[rel="stylesheet"]').forEach(i=>{const u=i.getAttribute("href")||"",d=new URL(u,t.url).href,r=document.createElement("link");r.rel="stylesheet",r.href=y(d),r.setAttribute(`data-${c}`,"1"),document.head.appendChild(r)}),a.querySelectorAll("script[src]").forEach(i=>{const u=i.getAttribute("src")||"",d=new URL(u,t.url).href,r=document.createElement("script");r.async=!0,r.src=y(d),r.setAttribute(`data-${c}`,"1"),document.body.appendChild(r)}),l.value=!1,window.scrollTo(0,0)}catch(t){console.error("Legacy page injection failed:",t);const n=document.getElementById(f);n&&(n.innerHTML='<p style="color:red">Legacy page not found.</p>'),l.value=!1}}return b(_),A(()=>h.fullPath,_),T(p),(e,o)=>(w(),k(N,null,{default:v(()=>[l.value?(w(),B("div",q,"Loading legacy module...")):M("",!0),o[0]||(o[0]=H("div",{id:"legacy-harbor-root",class:"rounded-1 overflow-hidden"},null,-1))]),_:1}))}},P=E(C,[["__scopeId","data-v-f5fc7821"]]);export{P as default};
