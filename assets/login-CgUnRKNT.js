const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CybY0i7o.js","assets/index-DhToL83V.js","assets/index-BMz2sQyU.css","assets/index-BLynw7KA.js","assets/index-DCmn2g3F.js"])))=>i.map(i=>d[i]);
import{_ as U,u as K,r as d,a as q,p as z,q as H,s as J,b as v,o as w,d as a,e as F,f as r,g as c,h as G,n as x,i as C,t as Y,w as p,j as u,k as W,l as m,m as Q}from"./index-DhToL83V.js";import{m as X,r as I,e as Z,u as ee,_ as te}from"./sp-TextInput-DNY4-u0o.js";import{u as oe}from"./useAcl-o_HAXGgX.js";import{u as ae}from"./useUtility-B4DnbHAI.js";const se={class:"w-100 h-100vh overflow-y-hidden"},ie={class:"row m-0 p-0"},ne={class:"col-12 col-lg-8 d-none d-lg-block bg-gradient h-100vh px-0"},re={class:"d-flex flex-column justify-content-between h-100vh"},le={class:"p-5 text-left"},ce=["src"],de={class:"col-12 col-lg-4 bg-white h-100vh py-3 py-lg-5 px-5"},pe={class:"d-flex h-100vh align-items-center align-content-center flex-wrap"},ue=["src"],me={class:"w-100"},fe={class:"d-flex mt-3"},ge={class:"d-flex my-3 text-center"},_e=["onClick","onKeypress"],ke={__name:"login",setup(he){const A=u(()=>m(()=>import("./index-CybY0i7o.js"),__vite__mapDeps([0,1,2]))),f=u(()=>m(()=>import("./index-BLynw7KA.js"),__vite__mapDeps([3,0,1,2]))),g=u(()=>m(()=>import("./index-DCmn2g3F.js"),__vite__mapDeps([4,1,2,0]))),_={COMPANY:"143200a0-6e2c-4a3a-b017-9586f1a8e6b8",DOCKYARD:"6444691d-adab-4ecd-8214-7a694cf4eb8a",HOTEL:"0580041f-27c1-463c-afec-3753095f0484",HOSPITAL:"b1bb118d-5d96-4ed2-8a27-d07c686b6a9b"},k=K(),h=J(),T=H(),s=ae(),i=d({email:"",password:"",is_submitted:!1}),E=d({modal_warning:!1}),o=d({fallback_url:"",is_error:!1,error_message:"",is_loading:!1,notification:{type:"",message:""}}),D=q(()=>({form:{email:{required:I,email:Z},password:{required:I,minLength:X(8)}}})),b=ee(D,{form:i});z(()=>{o.fallback_url=s.getCookie("fallback_url")??"/",window.innerWidth<=990&&(E.modal_warning=!0),$(),V()});function S(){return{email:i.email,password:i.password}}function y(){o.is_loading=!o.is_loading}function L(){const t=new Date,e=new Date(t.getTime()+10080*60*1e3+360*60*1e3),n=new Date(t.getTime()+696*60*60*1e3+360*60*1e3);s.setCookie("exp",JSON.stringify({access_token:e.getTime(),refresh_token:n.getTime()}))}function R(t){try{const e={id:t.id,name:t.name,email:t.email,type:t.type,image:t.profile_picture};if(!e.id||!e.name||!e.email||!e.type)throw new Error("Info user gagal dimuat");s.setCookie("user",JSON.stringify(e))}catch(e){console.log(e)}}function $(){const t=T.query.error;t==="user"?(o.notification.icon="ic-x-circle",o.notification.type="danger",o.notification.message="Info user gagal dimuat"):t==="fault"?(o.notification.icon="ic-x-circle",o.notification.type="danger",o.notification.message="Terjadi kesalahan pada halaman yang anda akses, kami harus membuat anda login kembali"):t==="token"&&(o.notification.icon="ic-x-circle",o.notification.type="danger",o.notification.message="Sesi telah berakhir, mohon login kembali untuk melanjutkan")}async function O(t){try{const e={id:t.corporate_detail.id,name:t.corporate_detail.name,npwp:t.corporate_detail.npwp,corporate_type:t.corporate_detail.corporate_type,spot_id:t.corporate_detail.spot_detail.id,spot_name:t.corporate_detail.spot_detail.name,membership_type:t.corporate_detail.spot_detail.membership_type};(!e.id||!e.name||!e.npwp||!e.spot_id||!e.spot_name||!e.membership_type)&&new Error("Info perusahaan gagal dimuat"),s.setCookie("corporate",JSON.stringify(e))}catch(e){s.setErrorContextSentry(e),$sentry.captureMessage(`${e.message} at processCorporateInfo FormLogin`),window.location.href="/login?error=user"}}function P(t){s.setCookie("token",t)}function N(t){s.setCookie("refresh_token",t)}function V(){s.getCookie("token")&&h.push(o.fallback_url)}async function M(){i.is_submitted=!0,await b.value.form.$validate(),b.value.form.$invalid||await j()}async function B(t){const{getRoleById:e}=oe(),n=await e(_[t.corporate_detail.corporate_type]);return n.defaultRoute||(s.setErrorContextSentry(error),$sentry.captureMessage(`role ${_[t.corporate_detail.corporate_type]} doesnt has default route`)),n.defaultRoute??"/logout?type=fault"}async function j(){y();try{const t=S(),{values:e}=await k.login(t),n=await B(e.data);o.notification.icon="ic-check-circle",o.notification.type="success",o.notification.message="Berhasil masuk, mengalihkan",P(e.access_token),N(e.refresh_token),R(e.data),O(e.data),L(),await k.checkAuth(),await h.push(n)}catch(t){o.notification.icon="ic-x-circle",o.notification.type="danger",o.notification.message=t.message}y()}return(t,e)=>{const n=W("router-link");return w(),v("div",se,[a("div",ie,[a("div",ne,[a("div",re,[a("div",le,[a("img",{src:r(s).getAssetUrl()+"/logo-dark.png",alt:"logo-spn",style:{"max-height":"42px"}},null,8,ce)]),e[2]||(e[2]=F('<div data-v-819d275b><div class="row mr-0 pr-0" data-v-819d275b><div class="col-12 col-lg-12" data-v-819d275b></div><div class="col-lg-5" data-v-819d275b><div class="d-flex flex-column justify-content-end align-items-end p-5 h-100" data-v-819d275b><div class="text-align-left" data-v-819d275b><p class="fw-bold fs-3" data-v-819d275b>Satu akun Satu Akses</p><p class="" data-v-819d275b> Atur keperluan anda badan usaha anda dalam satu aplikasi, Hubungi manajemen setempat untuk mendapatkan atau memperbanyak akun </p></div></div></div><div class="col-lg-7 text-right rounded-top border border-bottom-0 border-right-0 border-5 custom-border-color px-0" data-v-819d275b><img src="'+te+'" alt="" data-v-819d275b></div></div></div>',1))])]),a("div",de,[a("div",pe,[a("img",{src:r(s).getAssetUrl()+"/logo-dark.png",alt:"logo-spn",class:"d-block d-lg-none text-center mx-auto mb-5 mt-n5",style:{"max-height":"42px"}},null,8,ue),a("div",me,[e[4]||(e[4]=a("div",{class:"mt-lg-n5"},[a("p",{class:"fw-bold fs-3"},"Selamat Datang!"),a("p",{class:""}," Masukkan informasi akun anda untuk mengakases platform kami ")],-1)),a("div",fe,[o.notification.icon&&!o.is_loading?(w(),v("div",{key:0,id:"notification_message","data-testid":"notification_message",class:x(`alert alert-${o.notification.type} w-100 text-${o.notification.type} fw-bold py-2 px-3`)},[a("i",{class:x(`${o.notification.icon} text-xl`)},null,2),C(" "+Y(o.notification.message),1)],2)):G("",!0)]),c(r(f),{label:"Email","has-label-button":"",class:"my-2","error-text":"email tidak boleh kosong","is-error":!1},{input:p(()=>[c(r(g),{placeholder:"Masukkan email",text:i.email,"onUpdate:text":e[0]||(e[0]=l=>i.email=l),"has-icon-help":"",size:"sm","is-error":!0},null,8,["text"])]),_:1}),e[5]||(e[5]=a("div",{class:"my-3"},null,-1)),c(r(f),{label:"Password","has-label-button":"","error-text":"Password tidak boleh kosong","additional-class":"my-3","is-error":!1},{input:p(()=>[c(r(g),{placeholder:"Masukkan password",text:i.password,"onUpdate:text":e[1]||(e[1]=l=>i.password=l),"tail-button-icon":"ic-alert-circle",size:"sm","is-password":"","is-error":!0},null,8,["text"])]),_:1}),a("div",ge,[c(r(A),{"is-disabled":o.is_loading,text:"Masuk",onClick:M,class:"w-100 text-center"},null,8,["is-disabled"])]),a("p",null,[e[3]||(e[3]=C(" Lupa Password? Atur ulang password anda ",-1)),c(n,{to:"/forgot-password",custom:"",id:"link-to_forgot",ref:"link-to_forgot","data-testid":"link-to_forgot"},{default:p(({navigate:l})=>[a("span",{onClick:l,class:"text-primary cursor-pointer font-weight-bolder",onKeypress:Q(l,["enter"]),role:"link"}," disini ",40,_e)]),_:1},512)])])])])])])}}},xe=U(ke,[["__scopeId","data-v-819d275b"]]);export{xe as default};
