const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B1ymMMU8.js","assets/index-Csnn_HCA.js","assets/index-BMz2sQyU.css","assets/index-CAIaaScu.js","assets/index-DyVxrAxa.js"])))=>i.map(i=>d[i]);
import{_ as Z,r as $,a as N,o as B,b as s,d as ee,e as c,f as te,n as M,g as U,t as oe,w as h,u as j,p as q,m as G,h as m,i as K,k as z,j as f,l as ae,q as k,s as se}from"./index-Csnn_HCA.js";import{u as F}from"./useAcl-CRVvv2YK.js";import{m as H,r as b,e as J,u as Y,_ as ie}from"./preview-1-DpWCQsfo.js";import{u as W}from"./useUtility-DLVUOwel.js";const ne={__name:"login",setup(Q,{expose:i}){i();const y=f(()=>k(()=>import("./index-B1ymMMU8.js"),__vite__mapDeps([0,1,2]))),o=f(()=>k(()=>import("./index-CAIaaScu.js"),__vite__mapDeps([3,1,2,0]))),v=f(()=>k(()=>import("./index-DyVxrAxa.js"),__vite__mapDeps([4,1,2,0]))),p={COMPANY:"143200a0-6e2c-4a3a-b017-9586f1a8e6b8",DOCKYARD:"6444691d-adab-4ecd-8214-7a694cf4eb8a",HOTEL:"0580041f-27c1-463c-afec-3753095f0484",HOSPITAL:"b1bb118d-5d96-4ed2-8a27-d07c686b6a9b"},d=j(),n=q(),x=G(),r=W(),u=m({email:"",password:"",is_submitted:!1}),w=m({modal_warning:!1}),a=m({fallback_url:"",is_error:!1,error_message:"",is_loading:!1,notification:{type:"",message:""}}),C=K(()=>({form:{email:{required:b,email:J},password:{required:b,minLength:H(8)}}})),g=Y(C,{form:u});z(()=>{a.fallback_url=r.getCookie("fallback_url")??"/",window.innerWidth<=990&&(w.modal_warning=!0),S(),R()});function I(){return{email:u.email,password:u.password}}function _(){a.is_loading=!a.is_loading}function A(){const e=new Date,t=new Date(e.getTime()+10080*60*1e3+360*60*1e3),l=new Date(e.getTime()+696*60*60*1e3+360*60*1e3);r.setCookie("exp",JSON.stringify({access_token:t.getTime(),refresh_token:l.getTime()}))}function T(e){try{const t={id:e.id,name:e.name,email:e.email,type:e.type,image:e.profile_picture};if(!t.id||!t.name||!t.email||!t.type)throw new Error("Info user gagal dimuat");r.setCookie("user",JSON.stringify(t))}catch(t){console.log(t)}}function S(){const e=x.query.error;e==="user"?(a.notification.icon="ic-x-circle",a.notification.type="danger",a.notification.message="Info user gagal dimuat"):e==="fault"?(a.notification.icon="ic-x-circle",a.notification.type="danger",a.notification.message="Terjadi kesalahan pada halaman yang anda akses, kami harus membuat anda login kembali"):e==="token"&&(a.notification.icon="ic-x-circle",a.notification.type="danger",a.notification.message="Sesi telah berakhir, mohon login kembali untuk melanjutkan")}async function D(e){try{const t={id:e.corporate_detail.id,name:e.corporate_detail.name,npwp:e.corporate_detail.npwp,corporate_type:e.corporate_detail.corporate_type,spot_id:e.corporate_detail.spot_detail.id,spot_name:e.corporate_detail.spot_detail.name,membership_type:e.corporate_detail.spot_detail.membership_type};(!t.id||!t.name||!t.npwp||!t.spot_id||!t.spot_name||!t.membership_type)&&new Error("Info perusahaan gagal dimuat"),r.setCookie("corporate",JSON.stringify(t))}catch(t){r.setErrorContextSentry(t),$sentry.captureMessage(`${t.message} at processCorporateInfo FormLogin`),window.location.href="/login?error=user"}}function E(e){r.setCookie("token",e)}function L(e){r.setCookie("refresh_token",e)}function R(){r.getCookie("token")&&n.push(a.fallback_url)}async function X(){u.is_submitted=!0,await g.value.form.$validate(),g.value.form.$invalid||await P()}async function O(e){const{getRoleById:t}=F(),l=await t(p[e.corporate_detail.corporate_type]);return l.defaultRoute||(r.setErrorContextSentry(error),$sentry.captureMessage(`role ${p[e.corporate_detail.corporate_type]} doesnt has default route`)),l.defaultRoute??"/logout?type=fault"}async function P(){_();try{const e=I(),{values:t}=await d.login(e),l=await O(t.data);a.notification.icon="ic-check-circle",a.notification.type="success",a.notification.message="Berhasil masuk, mengalihkan",E(t.access_token),L(t.refresh_token),T(t.data),D(t.data),A(),await d.checkAuth(),await n.push(l)}catch(e){a.notification.icon="ic-x-circle",a.notification.type="danger",a.notification.message=e.message}_()}const V={ActionButton:y,InputGroup:o,TextInput:v,menuId:p,auth:d,router:n,route:x,$utility:r,form:u,modal:w,helper:a,rules:C,v$:g,setPayloadLogin:I,toggleLoadingButton:_,procesCountExpiredToken:A,processUserInfo:T,processCheckingError:S,processCorporateInfo:D,processAccessToken:E,processRefreshToken:L,processCheckLoginInfo:R,processSubmitForm:X,processGetDefaultRoute:O,processLoginInfo:P,ref:ae,reactive:m,computed:K,onMounted:z,get useAcl(){return F},defineAsyncComponent:f,get useRouter(){return q},get useRoute(){return G},get useVuelidate(){return Y},get required(){return b},get email(){return J},get minLength(){return H},get useAuthStore(){return j},get useUtility(){return W}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}},re={class:"w-100 h-100vh overflow-y-hidden"},le={class:"row m-0 p-0"},ce={class:"col-12 col-lg-8 d-none d-lg-block bg-gradient h-100vh px-0"},de={class:"d-flex flex-column justify-content-between h-100vh"},ue={class:"p-5 text-left"},pe=["src"],me={class:"col-12 col-lg-4 bg-white h-100vh py-3 py-lg-5 px-5"},fe={class:"d-flex h-100vh align-items-center align-content-center flex-wrap"},ge=["src"],_e={class:"w-100"},he={class:"d-flex mt-3"},ke={class:"d-flex my-3 text-center"},be=["onClick","onKeypress"];function ye(Q,i,y,o,v,p){const d=$("router-link");return B(),N("div",re,[s("div",le,[s("div",ce,[s("div",de,[s("div",ue,[s("img",{src:o.$utility.getAssetUrl()+"/logo-dark.png",alt:"logo-spn",style:{"max-height":"42px"}},null,8,pe)]),i[2]||(i[2]=ee('<div data-v-37b0c805><div class="row mr-0 pr-0" data-v-37b0c805><div class="col-12 col-lg-12" data-v-37b0c805></div><div class="col-lg-5" data-v-37b0c805><div class="d-flex flex-column justify-content-end align-items-end p-5 h-100" data-v-37b0c805><div class="text-align-left" data-v-37b0c805><p class="fw-bold fs-3" data-v-37b0c805>Satu akun Satu Akses</p><p class="" data-v-37b0c805> Atur keperluan anda badan usaha anda dalam satu aplikasi, Hubungi manajemen setempat untuk mendapatkan atau memperbanyak akun </p></div></div></div><div class="col-lg-7 text-right rounded-top border border-bottom-0 border-right-0 border-5 custom-border-color px-0" data-v-37b0c805><img src="'+ie+'" alt="" data-v-37b0c805></div></div></div>',1))])]),s("div",me,[s("div",fe,[s("img",{src:o.$utility.getAssetUrl()+"/logo-dark.png",alt:"logo-spn",class:"d-block d-lg-none text-center mx-auto mb-5 mt-n5",style:{"max-height":"42px"}},null,8,ge),s("div",_e,[i[4]||(i[4]=s("div",{class:"mt-lg-n5"},[s("p",{class:"fw-bold fs-3"},"Selamat Datang!"),s("p",{class:""}," Masukkan informasi akun anda untuk mengakases platform kami ")],-1)),s("div",he,[o.helper.notification.icon&&!o.helper.is_loading?(B(),N("div",{key:0,id:"notification_message","data-testid":"notification_message",class:M(`alert alert-${o.helper.notification.type} w-100 text-${o.helper.notification.type} fw-bold py-2 px-3`)},[s("i",{class:M(`${o.helper.notification.icon} text-xl`)},null,2),U(" "+oe(o.helper.notification.message),1)],2)):te("v-if",!0)]),c(o.InputGroup,{label:"Email","has-label-button":"",class:"my-2","error-text":"email tidak boleh kosong","is-error":!1},{input:h(()=>[c(o.TextInput,{placeholder:"Masukkan email",text:o.form.email,"onUpdate:text":i[0]||(i[0]=n=>o.form.email=n),"has-icon-help":"",size:"sm","is-error":!0},null,8,["text"])]),_:1}),i[5]||(i[5]=s("div",{class:"my-3"},null,-1)),c(o.InputGroup,{label:"Password","has-label-button":"","error-text":"Password tidak boleh kosong","additional-class":"my-3","is-error":!1},{input:h(()=>[c(o.TextInput,{placeholder:"Masukkan password",text:o.form.password,"onUpdate:text":i[1]||(i[1]=n=>o.form.password=n),"tail-button-icon":"ic-alert-circle",size:"sm","is-password":"","is-error":!0},null,8,["text"])]),_:1}),s("div",ke,[c(o.ActionButton,{"is-disabled":o.helper.is_loading,text:"Masuk",onClick:o.processSubmitForm,class:"w-100 text-center"},null,8,["is-disabled"])]),s("p",null,[i[3]||(i[3]=U(" Lupa Password? Atur ulang password anda ",-1)),c(d,{to:"/forgot-password",custom:"",id:"link-to_forgot",ref:"link-to_forgot","data-testid":"link-to_forgot"},{default:h(({navigate:n})=>[s("span",{onClick:n,class:"text-primary cursor-pointer font-weight-bolder",onKeypress:se(n,["enter"]),role:"link"}," disini ",40,be)]),_:1},512)])])])])])])}const Ie=Z(ne,[["render",ye],["__scopeId","data-v-37b0c805"],["__file","/Users/ikbalmaulana/Documents/spn/spn-mono-external/apps/remix-host/src/views/account/login.vue"]]);export{Ie as default};
